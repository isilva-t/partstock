{% extends "base.html" %}

{% block title %}Create New Unit - PartStock{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Create New Unit</h2>
    
    {% if error %}
    <div class="error-message">
        {{ error }}
    </div>
    {% endif %}
    
    <form method="POST" class="unit-form">
        <div class="form-group">
            <label for="product_id">Select Product *</label>
            <select name="product_id" id="product_id" required>
                <option value="">Choose a product...</option>
                {% for product in products %}
                <option value="{{ product.id }}" 
                    {% if selected_product and selected_product.id == product.id %}selected{% endif %}>
                    {{ product.sku }} - {{ product.description }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="selling_price">Selling Price (â‚¬) *</label>
            <input 
                type="number" 
                name="selling_price" 
                id="selling_price" 
                step="0.01" 
                min="0" 
                placeholder="0.00"
                required
            >
        </div>
        
        <div class="form-group">
            <label for="alternative_sku">Alternative SKU</label>
            <input 
                type="text" 
                name="alternative_sku" 
                id="alternative_sku" 
                placeholder="Custom reference (optional)"
                maxlength="100"
            >
        </div>
        
        <div class="form-group">
            <label for="km">Kilometers (Motor parts only)</label>
            <input 
                type="number" 
                name="km" 
                id="km" 
                min="0" 
                placeholder="Motor kilometers"
            >
        </div>
        
        <div class="form-group">
            <label for="observations">Observations</label>
            <textarea 
                name="observations" 
                id="observations" 
                placeholder="Notes about condition, defects, etc. (max 150 characters)"
                maxlength="150"
                rows="3"
            ></textarea>
            <small>Characters remaining: <span id="obs-char-count">150</span></small>
        </div>
        
        <div class="form-group">
            <label for="status">Status *</label>
            <select name="status" id="status" required>
                <option value="active">Active (Available for sale)</option>
                <option value="incomplete">Incomplete (Missing parts/info)</option>
                <option value="consume">Consume (Used in our cars)</option>
                <option value="sold">Sold</option>
            </select>
        </div>
        
        <div class="form-actions">
            <button type="button" onclick="history.back()" class="btn btn-secondary">Cancel</button>
            <button type="submit" class="btn btn-primary">Create Unit</button>
        </div>
    </form>
</div>



<script>
	// char counter for title
	document.getElementById('title').addEventListener('input', function() {
		const remaining = 70 - this.value.length;
		document.getElementById('title-char-count').textContent = remaining;
		
		if (remaining < 10) {
			document.getElementById('title-char-count').style.color = 'red';
		} else {
			document.getElementById('title-char-count').style.color = 'inherit';
		}
	});

    // Character counter for observations
    document.getElementById('observations').addEventListener('input', function() {
        const remaining = 150 - this.value.length;
        document.getElementById('obs-char-count').textContent = remaining;
        
        if (remaining < 10) {
            document.getElementById('obs-char-count').style.color = 'red';
        } else {
            document.getElementById('obs-char-count').style.color = 'inherit';
        }
    });

    // Convert price to cents before submission
    document.querySelector('.unit-form').addEventListener('submit', function(e) {
        const priceInput = document.getElementById('selling_price');
        const priceValue = parseFloat(priceInput.value);
        
        if (priceValue >= 0) {
            priceInput.value = Math.round(priceValue * 100);
        }
    });

    // Year/month validation
    document.getElementById('year_month').addEventListener('input', function() {
        const value = this.value.toUpperCase();
        this.value = value;
        
        if (value.length === 3) {
            const year = value.substr(0, 2);
            const month = value.substr(2, 1);
            
            if (!/^[0-9]{2}$/.test(year)) {
                this.setCustomValidity('Year must be 2 digits (e.g., 25 for 2025)');
            } else if (!/^[A-L]$/.test(month)) {
                this.setCustomValidity('Month must be A-L (A=Jan, B=Feb, ..., L=Dec)');
            } else {
                this.setCustomValidity('');
            }
        }
    });
</script>
{% endblock %}
