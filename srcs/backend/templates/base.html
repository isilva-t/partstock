<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PartStock - Inventory Management{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1><a href="/">PartStock</a></h1>
            <nav class="nav">
                <a href="/olx/auth">OLX Auth</a>
                <a href="/olx/drafts">OLX Drafts</a>
				<a href="/olx/adverts">OLX Adverts</a>
                <a href="/products/new">New Product</a>
                <a href="/units/new">New Unit</a>
            </nav>
			<div style="background:#eee; padding:0.5rem; text-align:right;">
			  {% if request.session.get("username") %}
				Logged in as <b>{{ request.session.get("username") }}</b>
				({{ request.session.get("role") }})
				| <a href="/change-password">Change Password</a>
				| <a href="/logout">Logout</a>
			  {% else %}
				<a href="/login">Login</a>
			  {% endif %}
			</div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 PartStock - Auto Parts Inventory</p>
        </div>
    </footer>

    <script>
        // Global JavaScript functions
        async function loadModels(makeId, targetSelectId) {
            if (!makeId) {
                document.getElementById(targetSelectId).innerHTML = '<option value="">Select models...</option>';
                return;
            }
            
            try {
                const response = await fetch(`/api/v1/catalog/makes/${makeId}/models`);
                const models = await response.json();
                
                const select = document.getElementById(targetSelectId);
                select.innerHTML = '<option value="">Select models...</option>';
                
                models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.id;
                    option.textContent = `${model.name} (${model.start_year}-${model.end_year})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading models:', error);
            }
        }

        // Search functionality
        function handleSearch(event) {
            const query = event.target.value.trim();
            if (event.key === 'Enter') { // without query for now, for empty search
                window.location.href = `/search?q=${encodeURIComponent(query)}`;
            }
        }

		function openPhotoModal(photoUrl, altText) {
			// Create modal if it doesn't exist
			let modal = document.getElementById('photo-modal');
			if (!modal) {
				modal = document.createElement('div');
				modal.id = 'photo-modal';
				modal.className = 'photo-modal';
				modal.innerHTML = `
					<button class="close-btn" onclick="closePhotoModal()">&times;</button>
					<img id="modal-photo" src="" alt="">
				`;
				document.body.appendChild(modal);
				
				// Close modal when clicking outside the image
				modal.addEventListener('click', function(e) {
					if (e.target === modal) {
						closePhotoModal();
					}
				});
				
				// Close modal with Escape key
				document.addEventListener('keydown', function(e) {
					if (e.key === 'Escape' && modal.style.display === 'block') {
						closePhotoModal();
					}
				});
			}
			
			// Set image source and show modal
			const img = document.getElementById('modal-photo');
			img.src = photoUrl;
			img.alt = altText;
			modal.style.display = 'block';
			document.body.style.overflow = 'hidden'; // Prevent scrolling
		}

		function closePhotoModal() {
			const modal = document.getElementById('photo-modal');
			if (modal) {
				modal.style.display = 'none';
				document.body.style.overflow = 'auto'; // Restore scrolling
			}
		}
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
